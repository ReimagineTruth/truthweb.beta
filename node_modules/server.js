const express = require('express');
const app = express();
const path = require('path');

app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

let products = [
  { id: '1', title: 'eBook: Learn JS', description: 'Master JavaScript', price: 10, image: 'https://via.placeholder.com/150', category: 'eBooks' },
  { id: '2', title: 'Software: Code Editor', description: 'Powerful editor', price: 20, image: 'https://via.placeholder.com/150', category: 'Software' },
  { id: '3', title: 'Course: Web Dev', description: 'Full-stack course', price: 30, image: 'https://via.placeholder.com/150', category: 'Courses' }
];
let cart = [];

app.get('/api/products', (req, res) => res.json(products));

// New route to get a single product by ID
app.get('/api/products/:id', (req, res) => {
  const product = products.find(p => p.id === req.params.id);
  if (product) res.json(product);
  else res.status(404).json({ error: 'Product not found' });
});

app.get('/api/cart', (req, res) => res.json(cart));

app.post('/api/cart', (req, res) => {
  const { productId, quantity } = req.body;
  const product = products.find(p => p.id === productId);
  if (!product) return res.status(404).json({ error: 'Product not found' });

  const cartItem = cart.find(item => item.productId === productId);
  if (cartItem) {
    cartItem.quantity += quantity;
  } else {
    cart.push({ productId, title: product.title, price: product.price, image: product.image, quantity });
  }
  res.json(cart);
});

// New route to clear the cart
app.post('/api/cart/clear', (req, res) => {
  cart = [];
  res.json({ success: true });
});

app.post('/api/payment', (req, res) => {
  cart = []; // Clear cart after payment
  res.json({ success: true });
});

app.listen(3000, () => console.log('Server running on port 3000'));
